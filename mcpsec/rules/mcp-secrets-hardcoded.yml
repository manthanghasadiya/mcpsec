rules:
  # ═══════════════════════════════════════════════════════════════
  # HARDCODED SECRETS — API keys, passwords, tokens, private keys
  # ═══════════════════════════════════════════════════════════════

  # --- AWS Access Key ID ---
  - id: secret-aws-access-key
    pattern-regex: "AKIA[0-9A-Z]{16}"
    languages: [typescript, javascript, python, go, java]
    severity: ERROR
    message: >
      Hardcoded AWS Access Key ID detected. Rotate this key immediately
      and use environment variables or IAM roles instead.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: HIGH

  # --- AWS Secret Access Key pattern ---
  - id: secret-aws-secret-key
    pattern-regex: "(?i)(aws_secret_access_key|aws_secret_key)\\s*[:=]\\s*['\"][a-zA-Z0-9/+=]{40}['\"]"
    languages: [typescript, javascript, python, go]
    severity: ERROR
    message: >
      AWS Secret Access Key in source code. Use environment variables
      or AWS Secrets Manager.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: HIGH

  # --- Private keys ---
  - id: secret-private-key
    pattern-regex: "-----BEGIN (RSA |EC |DSA |OPENSSH |PGP )?PRIVATE KEY-----"
    languages: [typescript, javascript, python, go, java, ruby]
    severity: ERROR
    message: >
      Private key embedded in source code! Remove immediately and
      rotate the key.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: HIGH

  # --- OpenAI / Anthropic / other AI API keys ---
  - id: secret-ai-api-key
    pattern-regex: "sk-[a-zA-Z0-9]{20,}"
    languages: [typescript, javascript, python, go]
    severity: ERROR
    message: >
      Potential AI service API key (OpenAI/Anthropic sk-...) in source code.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: HIGH

  # --- GitHub tokens ---
  - id: secret-github-token
    pattern-regex: "(ghp|gho|ghu|ghs|ghr)_[A-Za-z0-9_]{36,}"
    languages: [typescript, javascript, python, go]
    severity: ERROR
    message: >
      GitHub personal access token or OAuth token in source code.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: HIGH

  # --- Slack tokens ---
  - id: secret-slack-token
    pattern-regex: "xox[baprs]-([0-9a-zA-Z]{10,48})"
    languages: [typescript, javascript, python, go]
    severity: ERROR
    message: >
      Slack token in source code. Use environment variables.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: HIGH

  # --- Generic API key assignment ---
  - id: secret-generic-api-key
    pattern-regex: "(?i)(api[_-]?key|apikey|api[_-]?secret|api[_-]?token)\\s*[:=]\\s*['\"][a-zA-Z0-9_\\-]{20,}['\"]"
    languages: [typescript, javascript, python, go]
    severity: WARNING
    message: >
      Potential hardcoded API key detected. Use environment variables.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: MEDIUM

  # --- Password/secret in assignments ---
  - id: secret-password-assignment
    pattern-regex: "(?i)(password|passwd|pwd|db_pass|secret|token)\\s*[:=]\\s*['\"][^'\"\\s]{8,}['\"]"
    languages: [typescript, javascript, python, go]
    severity: WARNING
    message: >
      Potential hardcoded password or secret. Use environment variables
      or a secrets manager.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: MEDIUM

  # --- JWT hardcoded secret ---
  - id: secret-jwt-hardcoded
    patterns:
      - pattern-either:
          - pattern: jwt.sign($DATA, "...", ...)
          - pattern: jwt.verify($TOKEN, "...", ...)
          - pattern: jwt.sign($DATA, '...', ...)
          - pattern: jwt.verify($TOKEN, '...', ...)
    languages: [typescript, javascript]
    severity: ERROR
    message: >
      JWT secret is hardcoded. Use environment variables for signing keys.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: HIGH

  # --- Connection strings with credentials ---
  - id: secret-connection-string
    pattern-regex: "(?i)(mongodb|postgres|mysql|redis|amqp)://[^:]+:[^@]+@"
    languages: [typescript, javascript, python, go]
    severity: WARNING
    message: >
      Database connection string with embedded credentials. Use
      environment variables for connection details.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: MEDIUM

  # --- Bearer tokens ---
  - id: secret-bearer-token
    pattern-regex: "(?i)(authorization|bearer)\\s*[:=]\\s*['\"]Bearer\\s+[a-zA-Z0-9._\\-]{20,}['\"]"
    languages: [typescript, javascript, python, go]
    severity: WARNING
    message: >
      Hardcoded Bearer token in source code.
    metadata:
      cwe: CWE-798
      category: secrets-exposure
      confidence: MEDIUM
