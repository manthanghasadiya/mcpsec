# âš¡ mcpsec

[![License: MIT](https://img.shields.io/badge/License-MIT-cyan.svg)](https://opensource.org/licenses/MIT)
[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![Version](https://img.shields.io/badge/version-0.5.4-orange.svg)](https://pypi.org/project/mcpsec/)

**Security scanner for MCP (Model Context Protocol) server implementations.**

MCP is the universal protocol connecting AI agents (Claude, ChatGPT, Gemini, Cursor) to external tools and data sources. It's adopted by every major AI company â€” Anthropic, OpenAI, Google, Microsoft. Its security is broken. `mcpsec` finds the vulnerabilities.

```
  â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
  â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•
  â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     
  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â• â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     
  â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
  â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•
```

## Why?

- **82%** of MCP implementations have path traversal vulnerabilities ([Endor Labs](https://www.endorlabs.com/learn/classic-vulnerabilities-meet-ai-infrastructure-why-mcp-needs-appsec))
- **67%** are vulnerable to code injection
- **~2,000** internet-exposed MCP servers found with **zero authentication** ([Knostic](https://www.descope.com/learn/post/mcp))
- Anthropic's own Git MCP server had **3 critical RCE vulnerabilities** (CVE-2025-68143/44/45)
- Nobody built an open-source scanner for this. Until now.

## Install

```bash
pip install mcpsec
```

## Quick Start

```bash
# Scan an MCP server running via stdio
mcpsec scan --stdio "npx @modelcontextprotocol/server-filesystem /tmp"

# ğŸ’¥ Run Mega Fuzzer (500+ security test cases)
mcpsec fuzz --stdio "python my_server.py" --intensity high

# ğŸ§  Run AI-Powered Fuzzing (Context-aware adversarial payloads)
# Requires OPENAI_API_KEY
mcpsec fuzz --stdio "python my_server.py" --ai

# Enumerate attack surface
mcpsec info --stdio "python my_server.py"

# Static Audit (Source Code Analysis)
mcpsec audit --path . --ai

# List available scanners
mcpsec list-scanners
```

## Mega Fuzzer (New in v0.5.4)

`mcpsec` v0.5.4 introduces a significantly expanded fuzzing engine designed to find edge cases in MCP protocol handlers and tool implementations, along with critical fixes for OS-level buffer deadlocks preventing deep scanning of huge target stacks like the Kubernetes server.

- **500+ Security Test Cases**: Exhaustive coverage for malformed JSON, protocol violations, type confusion, boundary values, and encoding attacks.
- **AI-Powered Payloads**: Use `--ai` to leverage LLMs to generate context-aware adversarial payloads based on your server's specific tool schemas.
- **Enhanced Reliability**: Completely resolved a major "Fuzzer State Desync" bug that caused pipe deadlocks when target servers crashed under intense payloads.
- **Custom Timeouts**: Use `--timeout` (default 5.0s) to accommodate slower target servers like Puppeteer without triggering premature hang detections.
- **Refined Intensity Tiers**:
  - `low`: Core protocol smoke tests (~65 cases)
  - `medium`: Standard security baseline (~150 cases)
  - `high`: Full regression suite (500+ cases)
  - `insane`: Includes resource exhaustion and DoS patterns
  - `ai`: High intensity + AI-generated payloads

## Scanners

| Scanner | Type | What It Detects |
|---------|------|----------------|
| `prompt-injection` | Static | Hidden instructions, base64-encoded payloads, cross-tool manipulation, data exfiltration indicators in tool descriptions |
| `auth-audit` | Static | Missing authentication, over-permissioned tools, dangerous tool combinations, misleading annotations |
| `path-traversal` | Dynamic | File path traversal via `../../` payloads â€” **proves exploitation** with actual file contents |
| `command-injection` | Dynamic | OS command injection via shell escape characters â€” **proves exploitation** with command output |
| `ssrf` | Dynamic | Server-Side Request Forgery targeting cloud metadata endpoints and internal services |
| `protocol-fuzzer` | Dynamic | **(500+ Cases)** Malformed JSON-RPC, boundary testing, state-machine violations, type confusion to find crashes |
| `ai-payloads` | Dynamic | **(New)** Context-aware payloads generated by LLMs (SQLi, Logic bugs, Edge cases) |

## How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     MCP Protocol      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mcpsec  â”‚ â—„â”€â”€â”€â”€ JSON-RPC â”€â”€â”€â”€â–º  â”‚ Target MCP â”‚
â”‚ client  â”‚    (stdio or HTTP)    â”‚   Server   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€ 1. Connect (stdio subprocess or HTTP)
     â”œâ”€â”€ 2. Enumerate tools, resources, prompts  
     â”œâ”€â”€ 3. Run static scanners (analyze descriptions)
     â”œâ”€â”€ 4. Generate & Run dynamic payloads (Fuzzing + AI)
     â””â”€â”€ 5. Report findings with evidence + remediation
```

## Roadmap

- [x] Prompt injection scanner
- [x] Authentication & authorization audit
- [x] Path traversal scanner
- [x] Command injection scanner
- [x] SSRF scanner
- [x] JSON report output
- [x] **Static source code analysis mode**
- [x] **Protocol Fuzzer** (500+ security cases)
- [x] **AI-Powered Fuzzing** (Adversarial payload generation)
- [ ] **Interactive Remediation** (Automated patching for common vulnerabilities)

## Contributing

Contributions welcome! See [CONTRIBUTING.md](CONTRIBUTING.md) for details on how to set up your environment and add new scanners.

## Disclaimer

This tool is intended for authorized security testing only. Only scan MCP servers you own or have explicit permission to test. The authors are not responsible for misuse.

## License

[MIT](LICENSE)

---

*Built by [Manthan](https://www.linkedin.com/in/man-ghasadiya) â€” because your AI agents deserve a pentest too.*
